# 运行器设置

控制程序执行、资源测量和输出处理的设置。

## 运行器模式

### `cph-ng.runner.useRunner`

启用高级运行器以进行准确的内存和资源测量。

- **类型**：布尔值
- **默认值**：`false`
- **用户影响**：
    - `false`：使用标准进程执行（更快，但无内存测量）
    - `true`：使用高级运行器，可以测量内存使用量并提供更准确的资源跟踪

**示例**：

```json
{
    "cph-ng.runner.useRunner": true
}
```

_启用内存测量和更准确的资源跟踪。_

!!! note
"性能注意" 启用运行器会增加轻微开销，但提供准确的内存测量，这对于有内存限制的题目很有用。

### `cph-ng.runner.unlimitedStack`

启用无限栈大小，用于需要深度递归的竞赛编程题目。

- **类型**：布尔值
- **默认值**：`false`
- **前置条件**：需要启用 `cph-ng.runner.useRunner`
- **用户影响**：
    - `false`：使用系统默认栈大小（通常约 8MB）
    - `true`：在 Linux 上设置无限栈大小（通过 `setrlimit`），在 Windows 上设置大栈大小（256MB，通过编译器链接器标志）

**示例**：

```json
{
    "cph-ng.runner.useRunner": true,
    "cph-ng.runner.unlimitedStack": true
}
```

_允许深度递归而不会栈溢出。_

!!! warning
"重要提示" 此选项仅在启用 `cph-ng.runner.useRunner` 时有效。在不同操作系统上的实现方式不同：
    
    - **Linux**：在运行时使用 `setrlimit` 将栈大小设置为无限
    - **Windows**：在编译时使用 `/STACK` 链接器标志设置 256MB 栈大小

!!! tip
"使用场景" 当您的程序使用深度递归算法（如深度优先搜索、分治算法等）并遇到栈溢出错误时，启用此选项。

## 时间调整

### `cph-ng.runner.timeAddition`

运行测试时添加到时间限制的额外时间（以毫秒为单位）。

- **类型**：数字
- **默认值**：`200`
- **用户影响**：添加缓冲时间以考虑进程启动和系统开销。程序可以运行略长于题目时间限制而不会获得 TLE。

**示例**：

```json
{
    "cph-ng.runner.timeAddition": 500
}
```

_允许 500ms 的额外启动开销时间。_

### `cph-ng.runner.stderrThreshold`

显示警告前的最大标准错误输出大小（以字节为单位）。

- **类型**：数字
- **默认值**：`100000`（100KB）
- **用户影响**：如果您的程序向 stderr 写入超过此大小，将显示警告。帮助捕获输出过多调试信息的程序。

**示例**：

```json
{
    "cph-ng.runner.stderrThreshold": 1000000
}
```

_警告前允许最多 1MB 的 stderr。_

### `cph-ng.runner.stdoutThreshold`

截断前的最大标准输出大小（以字节为单位）。

- **类型**：数字
- **默认值**：`100000`（100KB）
- **用户影响**：大于此大小的输出会被截断。防止打印过多输出的程序导致内存问题。

**示例**：

```json
{
    "cph-ng.runner.stdoutThreshold": 500000
}
```

_允许最多 500KB 的输出。_

## 何时更改这些设置

**何时启用运行器**：

- 需要准确的内存测量
- 处理有内存限制的题目
- 调试内存泄漏
- 需要无限栈大小支持

**何时启用无限栈**：

- 程序使用深度递归算法
- 遇到栈溢出错误（Segmentation fault）
- 题目需要大量的函数调用栈空间
- 在不同环境（Windows/Linux）之间移动代码库

**何时增加时间添加**：

- 在较慢的系统上运行
- 在启动时获得虚假的 TLE
- 使用增加开销的消毒剂

**何时调整阈值**：

- 处理产生大输出的题目
- 调试具有详细日志记录的程序
- 收到截断警告

## 相关功能

- [运行单个测试](../features/run-single-test.md) - 执行期间使用这些设置
- [运行所有测试](../features/run-all-tests.md) - 将设置应用于所有测试运行
- [编辑题目](../features/edit-problem.md) - 为每个题目设置时间/内存限制
